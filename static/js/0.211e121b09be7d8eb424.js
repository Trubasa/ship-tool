webpackJsonp([0],{"NX/y":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("3cXf"),i=a.n(s),r={name:"volume-measure",data:function(){return{customTr:0,resultList:[],activeNames1:["1"],activeNames2:[],activeNames3:["1"],activeNames4:[],xlsxData:null,trList:[],selectValue:"",form:{},paramHeight:0,paramList:[],autoMeasure:"",maxVolume:"",fileName:"",sheet:"",leftTr:"",rightTr:""}},watch:{customTr:function(t){console.log("parseInt",parseInt(t));var e=null,a=null;t<0?(e=parseInt(t)-1,a=parseInt(t)):(e=parseInt(t),a=parseInt(t)+1);var s=this.$dataTransform.numToTr(e),i=this.$dataTransform.numToTr(a);console.log("parseInt",s,i),this.leftTr=s,this.rightTr=i},paramHeight:function(t){parseFloat(t)>this.maxGauge&&this.$message({message:"输入的液位大于数据最大值",type:"warning"}),this.paramList=this.getCalParam()},resultList:function(t){localStorage.setItem("resultList",i()(t))}},computed:{maxGauge:function(){return parseFloat(this.xlsxData[this.xlsxData.length-1].GAUGE)},manualMeasure:function(){if(0==this.paramList.length)return"";var t=this.paramList[0][this.selectValue],e=this.paramList[1][this.selectValue];console.log(t,e);var a=null;a=this.customTr<0?this.customTr-parseInt(this.customTr)+1:this.customTr-parseInt(this.customTr);t=(this.paramList[0][this.rightTr]-this.paramList[0][this.leftTr])/1*a+parseFloat(this.paramList[0][this.leftTr]),e=(this.paramList[1][this.rightTr]-this.paramList[1][this.leftTr])/1*a+parseFloat(this.paramList[1][this.leftTr]);return console.log(t,e),(e-t)*(this.paramHeight-parseFloat(this.paramList[0].GAUGE))/(parseFloat(this.paramList[1].GAUGE)-parseFloat(this.paramList[0].GAUGE))+parseFloat(t)},errorMeasure:function(){return""==this.manualMeasure||""==this.maxVolume?"":parseInt((this.manualMeasure-parseFloat(this.autoMeasure))/this.maxVolume*1e4)/100+"%"}},mounted:function(){this.$store.commit("changeTitle","舱容测量"),this.resultList=localStorage.resultList&&"[]"!=localStorage.resultList?JSON.parse(localStorage.resultList):[]},methods:{setXlsxInfo:function(t){this.fileName=t.fileName,this.sheet=t.sheet},saveResult:function(){var t={};for(var e in t["文件名"]=this.fileName,t["舱室"]=this.sheet,t["纵倾"]=this.selectValue,t["液位"]=this.paramHeight,t["遥测舱容"]=this.autoMeasure,t["手测舱容"]=this.manualMeasure,t["误差"]=this.errorMeasure,t["测量时间"]=this.$common.dateFormatter((new Date).getTime()),t)if(!this.$common.verify(e,t[e],"require"))return;this.resultList.unshift(t),this.resultList.length>productConfig.maxResultList&&this.resultList.pop(),this.$message({message:"保存成功",type:"success"})},setXlsxData:function(t){this.xlsxData=t,this.maxVolume=this.getMaxVolume(t),this.trList=this.getTrList(t),this.selectValue=this.trList[0],this.calculate()},trChange:function(t){},calculate:function(t){var e=this.getCalParam();this.paramList=e,e.length},getTrList:function(t){var e=[],a=t[0];for(var s in a)"GAUGE"!=s&&"ULL"!=s&&e.push(s);return e},getMaxVolume:function(t){var e=t[t.length-1],a=0;for(var s in e)"GAUGE"!=s&&"ULL"!=s&&parseFloat(e[s])>a&&(a=parseFloat(e[s]));return a},getCalParam:function(){var t=[];if(!this.xlsxData)return this.$message.info("暂无数据，请上传excel！"),t;for(var e=0;e<this.xlsxData.length;e++)if(parseFloat(this.xlsxData[e].GAUGE)>this.paramHeight){t.push(this.xlsxData[e-1]),t.push(this.xlsxData[e]);break}return t}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"volume-measure"},[a("div",{staticClass:"page_panel mgb"},[a("el-collapse",{model:{value:t.activeNames1,callback:function(e){t.activeNames1=e},expression:"activeNames1"}},[a("el-collapse-item",{attrs:{title:"数据选择",name:"1"}},[a("xlsx-analyze",{on:{xlsxData:function(e){t.setXlsxData(e)},xlsxInfo:t.setXlsxInfo}})],1)],1)],1),t._v(" "),a("div",{staticClass:"page_panel mgb"},[a("el-collapse",{model:{value:t.activeNames2,callback:function(e){t.activeNames2=e},expression:"activeNames2"}},[a("el-collapse-item",{attrs:{title:"数据列表",name:"1"}},[a("xlsx-table",{attrs:{data:t.xlsxData}})],1)],1)],1),t._v(" "),a("div",{staticClass:"page_panel mgb"},[a("el-collapse",{model:{value:t.activeNames3,callback:function(e){t.activeNames3=e},expression:"activeNames3"}},[a("el-collapse-item",{attrs:{title:"参数",name:"1"}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[t.trList?a("el-form-item",{attrs:{label:"纵倾"}},[t._v("\n            tr=\n            "),a("el-input",{staticStyle:{width:"95px"},attrs:{type:"number",step:"0.1"},model:{value:t.customTr,callback:function(e){t.customTr=e},expression:"customTr"}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"液位"}},[a("el-input",{staticClass:"input_normal",attrs:{type:"number"},model:{value:t.paramHeight,callback:function(e){t.paramHeight=e},expression:"paramHeight"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"遥测舱容"}},[a("el-input",{staticClass:"input_normal",attrs:{type:"number"},model:{value:t.autoMeasure,callback:function(e){t.autoMeasure=e},expression:"autoMeasure"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"手测舱容"}},[t._v("\n            "+t._s(t.manualMeasure)+"\n          ")]),t._v(" "),a("el-form-item",{attrs:{label:"误差"}},[t._v("\n            "+t._s(t.errorMeasure)+"\n          ")])],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"float_panel_br_1"},[a("el-button",{attrs:{type:"primary",circle:""},on:{click:t.saveResult}},[a("i",{staticClass:"iconfont icon-qianyuejilu"})])],1)])},staticRenderFns:[]};var n=a("46Yf")(r,l,!1,function(t){a("m4Nq"),a("kCqx")},"data-v-342ee421",null);e.default=n.exports},kCqx:function(t,e){},m4Nq:function(t,e){}});